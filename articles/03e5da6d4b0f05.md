---
title: "skkeletonã¸ã®JISYO.Lã‚’Nixã§ç®¡ç†ã™ã‚‹"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["neovim", "nix"]
published: true
---

# TL;DR
[ã“ã®ã‚³ãƒŸãƒƒãƒˆã‚’è¦‹ã‚â€¦ã€‚ãã“ã«å…¨ã¦ã®è²¡å®ãŒçœ ã£ã¦ã„ã‚‹â€¦ã€‚](https://github.com/haruki7049/my_nixos_config/commit/e05e38b8f555ed0b4d6da2183b6ca42a596f74bf)

# ä½•ã‚’ã—ãŸã‹
Neovimã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚ã‚‹ã€skkeletonã¸ã®JISYO.Lãƒ•ã‚¡ã‚¤ãƒ«ã‚’Nixã§ç®¡ç†ã—ãŸã€‚[home-manager](https://github.com/nix-community/home-manager)ã«ã¯ã€Neovimã®`init.lua`ã‚’æ›¸ãäº‹ã®å‡ºæ¥ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Š(programs.neovim.extraLuaConfig)ã€ãã“ã¸`lib.strings.concatStringsé–¢æ•°`ã‚’ä½¿ç”¨ã—ã¦ã€Nixå´ã§æ›¸ã„ãŸPATHä»˜ãã®æ–‡å­—åˆ—ã¨ã€å…ƒã€…ã‚ã£ãŸ`init.lua`ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã®æ–‡å­—åˆ—ã‚’ã‚¬ãƒƒãƒãƒ£ãƒ³ã‚³ã—ãŸã€‚

ä½¿ç”¨ã—ãŸé–¢æ•°ã®ãƒªã‚¹ãƒˆã‚’æ²ç¤ºã™ã‚‹â€¦ã€‚
- [lib.strings.concatStrings](https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-strings)
- [builtins.readFile](https://nix.dev/manual/nix/2.23/language/builtins.html#builtins-readFile)

```nix
{ lib, pkgs, ... }:

let
  skkeleton-jisyo = ''
    -- SKKELETON's JISYO
    vim.api.nvim_exec(
      [[
      call skkeleton#config({
        \   'globalDictionaries': ['${pkgs.skk-dicts}/share/SKK-JISYO.L'],
        \   'eggLikeNewline': v:true,
        \ })
    ]],
      false
    )
  '';
in
{
  programs.neovim.extraLuaConfig = lib.strings.concatStrings [
    (builtins.readFile ./init.lua)
    skkeleton-jisyo
  ];
}
```

## é–¢æ•°ã®èª¬æ˜
1. [lib.strings.concatStrings](https://nixos.org/manual/nixpkgs/stable/#sec-functions-library-strings)
ä¸€ã¤ã®ãƒªã‚¹ãƒˆã‚’å¼•æ•°ã«å–ã‚Šã€ãã®ãƒªã‚¹ãƒˆå†…ã®æ–‡å­—åˆ—ã‚’ç¹‹ã’ã‚‹é–¢æ•°ã€‚ã“ã®ãƒªã‚¹ãƒˆã«ã¯è¤‡æ•°ã®æ–‡å­—åˆ—ã‚’å«ã¾ã›ã‚‹äº‹ãŒå¯èƒ½ã€‚ä¾‹ã‚’æŒ™ã’ã‚‹ã¨ã€ä»¥ä¸‹ã®é€šã‚Šã€‚ã“ã®è¦é ˜ã§ã€skkeleton-jisyoã¸ã®ãƒ‘ã‚¹ãŒå«ã¾ã‚ŒãŸæ–‡å­—åˆ—ã¨`init.lua`ã‚’ã‚¬ãƒƒãƒãƒ£ãƒ³ã‚³ã—ãŸã€‚
```nix
lib.strings.concatStrings [
  "foo"
  "bar"
]
# Result: "foobar"
```

2. [builtins.readFile](https://nix.dev/manual/nix/2.23/language/builtins.html#builtins-readFile)
ä¸€ã¤ã®PATHã‚’å¼•æ•°ã«å–ã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°ã€‚å½“ãŸã‚Šå‰ã ãŒã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¤–ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹ã¨ã€`nix-flakes`ä¸Šã§ã¯ç´”ç²‹ã§ã¯ãªããªã£ã¦ã—ã¾ã„ã€`--impure`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã«ãªã£ã¦ã—ã¾ã†ã€‚
```nix
builtins.readFile ./init.lua
# Result: "init.lua"ã®ä¸­èº«
```

## ä½¿ç”¨ä¾‹
ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€`test.txt`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’èª­ã¿è¾¼ã¿ã€ãã‚Œã«`foo`ã¨ã„ã†æ–‡å­—åˆ—ã‚’ç¹‹ã’ãŸã‚‚ã®ã‚’`/nix/store/{nix-path}-hoge`ã¨ã—ã¦æ›¸ãå‡ºã—ã¦ã„ã‚‹ã€‚ãªãŠã€ã“ã“ã§å‡ºã¦ããŸ[writeTextFile](https://ryantm.github.io/nixpkgs/builders/trivial-builders/)ã¨ã„ã†é–¢æ•°ã¯ã€`nixpkgs`ã«å«ã¾ã‚Œã¦ã„ã‚‹é–¢æ•°ã§ã‚ã‚Šã€å˜é †ã«`/nix/store/{nix-path}-{name}`ã¨ã—ã¦æ›¸ãå‡ºã™é–¢æ•°ã§ã‚ã‚‹ã€‚
```nix
{ pkgs ? import <nixpkgs> { }
, lib ? pkgs.lib
, writeTextFile ? pkgs.writeTextFile
}:

writeTextFile {
  name = "hoge";
  text = lib.strings.concatStrings [
    (builtins.readFile ./test.txt)
    "foo"
  ];
```

## Home-Managerã§ã®ä½¿ç”¨ä¾‹
```
{ lib, pkgs, ... }:
let
  skkeleton-jisyo = ''
    -- SKKELETON's JISYO
    vim.api.nvim_exec(
      [[
      call skkeleton#config({
        \   'globalDictionaries': ['${pkgs.skk-dicts}/share/SKK-JISYO.L'],
        \   'eggLikeNewline': v:true,
        \ })
    ]],
      false
    )
  '';
in
{

  # ~~ home.packagesãªã©ã®è¨˜è¿° ~~

  programs.neovim = {
    enable = true;
    extraLuaConfig = lib.strings.concatStrings [
      (builtins.readFile ./init.lua)
      skkeleton-jisyo
    ];
  };
}
```

# æ³¨æ„ç‚¹
ä»Šå›ã®ä¾‹ã ã¨ã€Luaç”¨ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚„ãƒªãƒ³ã‚¿ãƒ¼ã¯é©ç”¨ã•ã‚Œãªã„ã€‚ãªãœãªã‚‰ã°ã€Nixä¸Šã§ã®ãŸã ã®æ–‡å­—åˆ—ã ã‹ã‚‰ã ã€‚ã—ã‹ã—ã€PATHã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹äº‹ã¯Nixã§ã—ã‹å‡ºæ¥ãªã„äº‹ã§ã‚ã‚‹ã€‚ã“ã®ç‚¹ãŒã€ã“ã®æ–¹æ³•ã®å•é¡Œç‚¹ã§ã‚ã‚ã†ã€‚
